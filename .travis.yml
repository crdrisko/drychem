### DryChem Build Matrix ###
language: cpp

matrix:
  include:
    - stage: coverage   ## Provide code coverage reports
      os: linux
      dist: bionic
      compiler: gcc
      arch: amd64
      addons:
        apt:
          packages:
            - python-pip
            - lcov
          update: true
      install:
        - if [ $TRAVIS_OS_NAME = linux ]; then pip install --user cpp-coveralls; fi
      script:
        - mkdir build && cd build
        - cmake ../. -Dchem_enable_coverage=ON
        - make && sudo make install
        - ctest --output-on-failure
        - lcov --directory . --capture --output-file coverage.info
        - lcov --remove coverage.info '*gtest*' '*/libs/*' '/usr/*' --output-file coverage.info
        - coveralls -r ../../. --l coverage.info -n
        - bash <(curl -s https://codecov.io/bash) -s "!*/libs/*"
